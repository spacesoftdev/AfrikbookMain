
{% extends 'base.html' %}


{% block content %}

    <a class="flex items-center justify-between bg-slate-200 py-1 px-2 text-sm font-semibold text-slate-600 rounded-lg shadow-md focus:outline-none focus:shadow-outline-purple"
      href="#">
        <div class="flex items-center">
            <svg
                class="w-5 h-5 mr-2"
                fill="currentColor"
                viewBox="0 0 20 20"
            >
            <path
                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
            ></path>
            </svg>
            <span>Transfer History</span>
        </div>
        <span>Home &RightArrow;</span>
    </a>
    <div class="px-4 py-2 my-5 bg-white rounded-lg shadow-md">
        <div class="grid grid-cols-2 gap-4">
            <div class="col-span-1 p-2 border-r">
              <!-- Content for the first column -->
                <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3 ">
                <!-- <div class="grid grid-cols-2  md:grid-cols-2 xl:grid-cols-4 mt-5"> -->
                    <label class="block text-sm">
                        <span class="text-gray-700">
                            From
                        </span>
                        <input 
                            type="date"
                            class="block w-full py-2 px-2 text-sm border-2 rounded-md focus:border-slate-300 focus:outline-none focus:shadow-outline-green text-slate-600 form-input"
                            placeholder=""
                            id="fromdate"
                        />
                    </label>
        
                    <label class="block text-sm">
                        <span class="text-gray-700">
                            To
                        </span>
                        <input 
                            type="date"
                            class="block w-full py-2 px-2 text-sm border-2 rounded-md focus:border-slate-300 focus:outline-none focus:shadow-outline-green text-slate-600 form-input"
                            placeholder=""
                            id="todate"
                        />
                    </label>
    
                    <label class="block text-sm">
                        <span class="text-gray-700">
                            Search(item code)
                        </span>
                        <input 
                            type="text"
                            class="block w-full py-2 px-2 mt-1 text-sm border-2 rounded-md focus:border-slate-300 focus:outline-none focus:shadow-outline-green text-slate-600 form-input shadow-lg"
                            placeholder=""
                            id="searchItem"
                        />
                    </label>
                    <div class="block text-sm mt-5"> 
                        <button  type='button' class="Search w-full py-2 px-2 mt-1 text-sm font-medium leading-5 text-center text-gray-600 transition-colors duration-150 bg-slate-200 border border-transparent rounded-lg active:bg-slate-300 hover:bg-slate-300 focus:outline-none focus:shadow-outline-slate">
                            Search
                        </button>
                    </div>
                    <!-- <label class="block text-sm">
                        <span class="text-gray-700">Dept Name</span>
                        <input 
                            type="text"
                            class="block w-full px-2 mt-1 text-sm border-2 rounded-md focus:border-slate-300 focus:outline-none focus:shadow-outline-green text-slate-600 form-input shadow-lg"
                            placeholder=""
                        />
                        
                    </label> -->
                </div>  
            </div>
            
            <div class="col-span-1">
                <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-2 ">
                    <!-- <div class="grid grid-cols-2  md:grid-cols-2 xl:grid-cols-4 mt-5"> -->
                    <label class="block text-sm">
                        <span class="text-gray-700">
                            Select by item
                        </span>
                        <select class="commonClass block w-full py-2 px-2 mt-1 text-sm border-2 rounded-md focus:border-slate-300 form-select focus:outline-none focus:shadow-outline-green text-slate-600 shadow-lg" id="selectItem"  name="">
                            <option>_ _Choose Item_ _</option>
                            {% for item in items %}
                                <option>{{item}} </option>
                            {% endfor %}
                        
                        </select>
                    </label>
        
                   
                    <label class="block text-sm">
                        <span class="text-gray-700">Search transfer</span>
                        <select class="commonClass block w-full py-2 px-2 mt-1 text-sm border-2 rounded-md focus:border-slate-300 form-select focus:outline-none focus:shadow-outline-green text-slate-600 shadow-lg" id="selectTransfer">
                            <option>_ _Choose Option_ _</option>
                            <option value="W_w">warehouse to warehouse</option>
                            <option value="W_O">warehouse to outlet</option>
                            <option value="O_W">outlet to warehouse</option>
                            <option value="O_O">outlet to outlet</option>
                        </select>
                        
                    </label>
    
                    
                    <label class="block text-sm">
                        <span class="text-gray-700">From</span>
                        
                        <select class="commonClass block w-full py-2 px-2 mt-1 text-sm border-2 rounded-md focus:border-slate-300 form-select focus:outline-none focus:shadow-outline-green text-slate-600 shadow-lg" id="selectFrom">
                            <option>_ _Choose From_ _</option>

                            {% for warehouse in warehouse %}
                                <option>{{warehouse.warehouse_name}}</option>
                            {% endfor %}
                            {% for shop in shop %}
                                <option>{{shop.outlet_name}}</option>
                            {% endfor %}
                                                       
                        </select>
                    </label>
                    <label class="block text-sm">
                        <span class="text-gray-700">To</span>
                        <select class="commonClass block w-full py-2 px-2 mt-1 text-sm border-2 rounded-md focus:border-slate-300 form-select focus:outline-none focus:shadow-outline-green text-slate-600 shadow-lg" id="selectTo">
                            <option>_ _Choose To_ _</option>
                            {% for shop in shop %}
                                <option>{{shop.outlet_name }}</option>
                            {% endfor %}

                            {% for warehouse in warehouse %}
                                <option>{{warehouse.warehouse_name}}</option>
                            {% endfor %}

                        </select>
                        
                    </label>
    
                    <!-- <label class="block text-sm">
                        <span class="text-gray-700">Dept Name</span>
                        <input 
                            type="text"
                            class="block w-full px-2 mt-1 text-sm border-2 rounded-md focus:border-slate-300 focus:outline-none focus:shadow-outline-green text-slate-600 form-input shadow-lg"
                            placeholder=""
                        />
                        
                    </label> -->
                </div>  
            </div>
        </div>
      
    </div>

    <div class="w-full my-5 overflow-hidden rounded-lg shadow-xs" id="printContent">
        <div class="w-full overflow-x-auto table-responsive">
          <table id="historyTable" class="display py-3 border-collapse border border-slate-400 w-full" style="width:100%">
              
                <thead>
                    <tr class="font-medium tracking-wide text-left  px-4 text-gray-500 border-b bg-gray-200">
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">SN</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Stockin Date</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Item Code</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Item Name</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Sell. Price</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Qty In Stock</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">From</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">To</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Token ID</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Transfered By</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Ref No.</th>
                        <th class="border border-slate-300 px-4 py-3 text-[10px] ...">Delete</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y">

            </table>
        </div>
    </div>

    <div class="px-4 py-3 my-5 bg-white rounded-lg shadow-md">
        <div class="grid grid-cols-2  gap-6">
            <button  type='button' onclick="printModal.showModal()" class=" h-8  px-4  mt-5 text-sm font-medium leading-5 text-center text-gray-600 transition-colors duration-150 bg-slate-200 border border-transparent rounded-lg active:bg-slate-300 hover:bg-slate-300 focus:outline-none focus:shadow-outline-slate" id="openModalButton">
                Print
            </button>
            <a class="block w-full px-4 py-1 mt-4 text-sm font-medium leading-5 text-center text-gray-600 transition-colors duration-150 bg-slate-200 border border-transparent rounded-lg active:bg-slate-300 hover:bg-slate-300 focus:outline-none focus:shadow-outline-slate"
                href="#">
                Export to Excel
            </a>
        </div>
    </div>
<script>

function resultFunction(res){
    if(res.data.failed){
        alert(res.data.failed)
    }else{
        $('#historyTable tbody').empty();
        res.data.forEach(function(item, index) {
            let newRow = $('<tr id="deleteitemID'+ item.id + '">');

            // Add data to the row
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + (index + 1) + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.datetx + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.item_code + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.item + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.selling_price + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.quantity + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.warehouse + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.outlet + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.token_id + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.Userlogin + '</td>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ...">' + item.ref_no + '</td>');
            let svgElement = $('<svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20">\
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>\
                        </svg>');
            newRow.append('<td class="text-[10px] border border-slate-300 py-0 my-0 font-medium tracking-wide ..."> <button type="button" onclick="deleteFunction(\'' + item.id + '\')" class="flex items-center justify-center text-red-600" aria-label="Delete">' + svgElement[0].outerHTML  +'</button></td>');
                // Add more columns as needed
                $('#historyTable tbody').append(newRow);

        });
        // Append the row to the table body
        }
}
// const makeChanges = ((any)=>{
$(document).ready(function() {

    $(document).on('click', '.Search', function(){
        let searchItem    =  $('#searchItem').val();
        let fromdate    =  $('#fromdate').val();
        let todate    =  $('#todate').val();
    
        $.ajax({
            type: 'GET',
            url: "{% url 'Stock:TransferHistory' %}",
            data: {
                searchItem: searchItem,
                fromdate: fromdate,
                todate: todate,
                
            },
            success: function(res){
                resultFunction(res)
            }
        })
    });
    $(document).on('change', '.commonClass', function(){
        let selectItem  =  $('#selectItem').val();
        let selectFrom  =  $('#selectFrom').val();
        let selectTo    =  $('#selectTo').val();
        let selectTransfer    =  $('#selectTransfer').val();
        $.ajax({
            type: 'GET',
            url: "{% url 'Stock:TransferHistory' %}",
            data: {
                selectItem: selectItem,
                selectFrom: selectFrom,
                selectTo: selectTo,
                selectTransfer: selectTransfer,
            },
            success: function(res){
                resultFunction(res)
            }
        })      
    })


});

function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Check if this cookie contains the desired name
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function deleteFunction(id){
    var csrftoken = getCookie('csrftoken');
    $.ajax({
        type: 'POST',
        url: "{% url 'Stock:DeleteItem' %}",
        headers: { 'X-CSRFToken': csrftoken },
        data: {
            deleteID: id,
        },
        success: function(response) {
            $('#deleteitemID'+id).remove();

            // $(document).ready(function() {
                toastr.options = {
                    closeButton: true,
                    positionClass: 'toast-top-right',
                    progressBar: true,
                };
                toastr.success(response.message, "Success");
            // });
        },
        error: function(error) {
            $(document).ready(function() {
                toastr.options = {
                    closeButton: true,
                    positionClass: 'toast-top-right',
                    progressBar: true,
                };
                toastr.error(error.error, "Error");
            });
        }
     })      
}

</script>
{% endblock content %} 